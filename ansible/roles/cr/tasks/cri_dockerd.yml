---
- name: (cri-dockerd) install package
  apt:
    deb: "https://github.com/Mirantis/cri-dockerd/releases/download/v{{ cr.cri_dockerd.version }}/cri-dockerd_{{ cr.cri_dockerd.version }}.3-0.ubuntu-{{ ansible_distribution_release }}_amd64.deb"

- name: (cri-dockerd) add unit file(s)
  copy:
    src: files/etc/systemd/system/{{ item }}
    dest: /etc/systemd/system/{{ item }}
  with_items:
    - cri-docker.service
    - cri-docker.socket

- name: (cri-dockerd) reload daemon
  systemd:
    daemon_reload: yes

- name: (cri-dockerd) enable services
  systemd:
    name: "{{ item }}"
    daemon_reload: true
    state: started
    enabled: true
  with_items:
    - cri-docker.service
    - cri-docker.socket

- name: (cri-dockerd) purge files
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /tmp/cri-dockerd.amd64.tgz
    - /tmp/cri-dockerd/cri-dockerd
